<app-encabezado titulo="Cargar factura"/>
<app-respuesta-server />

<div class="contenedor-pagina">
    <div class="contenedor-formulario">
        <form [formGroup]="formularioCargarnotaCredito" (ngSubmit)="cargarNotaCredito();">
            <div class="titulo-seccion">Datos cliente</div>
            <mat-form-field class="input-mediano">
                <mat-label for="cliente">Cliente</mat-label>
                <input #inputCliente type="text" id="cliente" placeholder="Seleccione el cliente" matInput formControlName="cliente" [matAutocomplete]="autocompletarCliente" (input)="filter('cliente');" (focus)="filter('cliente')">
                <mat-autocomplete requireSelection #autocompletarCliente="matAutocomplete" (optionSelected)="obtenerUltimoCae();">
                    <mat-option *ngFor="let datosCliente of valoresFiltradosClientes" [value]="datosCliente.clientName">{{datosCliente.clientName | uppercase }}</mat-option>
                </mat-autocomplete>
                <mat-error>Debe indicar el cliente</mat-error>
            </mat-form-field>
            <mat-form-field class="input-mediano">
                <mat-label for="cae-nota-credito">CAE nota de crédito</mat-label>
                <input matInput placeholder="" id="cae-nota-credito" value="" formControlName="cae" readonly>
            </mat-form-field>
            <mat-form-field class="input-mediano">
                <mat-label for="observaciones">Observaciones</mat-label>
                <input matInput placeholder="" id="descuento" value="" formControlName="observaciones">
            </mat-form-field>

            <ng-container formArrayName="items">
                <div class="titulo-seccion">Datos items</div>
                <div class="contenedor-items-nota-credito">
                    <div class="fila-agregar-item" *ngFor="let item of items.controls; let j = index" [formGroupName]="j">
                        <input type="text" class="input-fila input-fila-extendido" formControlName="descripcion" placeholder="Descripción" (input)="verificarAgregarItems()" (change)="verificarAgregarItems();" >
                        <input class="input-fila input-fila-mediano" formControlName="importe" placeholder="Importe">
                        <input class="input-fila input-fila-mediano" formControlName="iva" placeholder="Tipo de iva">
                        <button type="button" class="icono-eliminar-fila" mat-icon-button (click)="eliminarFilaItem(j)">
                            <mat-icon>close</mat-icon>
                        </button>
                    </div>
                </div>
            </ng-container>

            <mat-card-actions>
                <button class="input-extendido" mat-raised-button color="primary">Cargar factura</button>
            </mat-card-actions>   
        </form>
    </div>
</div>